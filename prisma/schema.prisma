generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id        String   @id @default(uuid())
  name      String
  companyNumber String?
  vatNumber String?
  email     String
  address   Json?
  invoices  Invoice[]
  createdAt DateTime @default(now())
}

model Product {
  id       String  @id @default(uuid())
  name     String
  unit     String  @default("unit")
  priceHt  Float
  vatRate  Float   @default(20.0)
  createdAt DateTime @default(now())
}

model Invoice {
  id         String       @id @default(uuid())
  number     String       @unique
  customerId String
  customer   Customer     @relation(fields: [customerId], references: [id])
  status     String       @default("draft")
  issueDate  DateTime
  dueDate    DateTime
  currency   String       @default("EUR")
  notes      String?
  totalHt    Float        @default(0)
  totalVat   Float        @default(0)
  totalTtc   Float        @default(0)
  pdfUrl     String?
  items      InvoiceItem[]
  payments   Payment[]
  createdAt  DateTime     @default(now())
}

model InvoiceItem {
  id           String  @id @default(uuid())
  invoiceId    String
  invoice      Invoice @relation(fields: [invoiceId], references: [id])
  productId    String?
  description  String
  quantity     Float
  unitPriceHt  Float
  vatRate      Float
  lineTotalHt  Float
  lineTotalVat Float
  lineTotalTtc Float
}

model Payment {
  id          String   @id @default(uuid())
  invoiceId   String?
  invoice     Invoice? @relation(fields: [invoiceId], references: [id])
  provider    String
  providerRef String?
  amount      Float
  paidAt      DateTime
  createdAt   DateTime @default(now())
}

model WebhookEvent {
  id        String   @id @default(uuid())
  provider  String
  eventType String
  payload   Json
  receivedAt DateTime @default(now())
}
